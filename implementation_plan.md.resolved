# Drone Survey Management System (DSMS) - Implementation Plan

## Overview

Building a **Sentry-inspired** Drone Survey Management System that enables organizations to plan, manage, and monitor autonomous drone surveys across multiple global sites.

### Design Philosophy (Borrowed from Sentry)

| Principle | Application |
|-----------|-------------|
| **Layered Architecture** | Separate by concern (models, api, services, tasks) not by feature |
| **Domain-Driven Design** | Clear bounded contexts with well-defined interfaces |
| **Event-Driven** | Real-time telemetry via pub/sub patterns |
| **Service Layer** | Business logic isolated in services, not in views/endpoints |
| **Convention over Configuration** | Consistent patterns across the codebase |

---

## Tech Stack

| Layer | Technology | Justification |
|-------|------------|---------------|
| **Backend** | Django 5.x + Django REST Framework | Production-ready, mature ecosystem |
| **ODM** | MongoEngine | Mature MongoDB ODM, document-based models |
| **Database** | MongoDB Atlas (Free M0) | 512MB free, time-series collections for telemetry |
| **Cache/Pub-Sub** | Redis (Upstash Free) | Real-time state, pub/sub for WebSocket events |
| **Real-time** | Django Channels + WebSocket | Live drone tracking, mission updates |
| **Task Queue** | Celery + Redis | Background jobs (simulator, analytics) |
| **Frontend** | React 18 + TypeScript + Vite | Fast DX, excellent maps ecosystem |
| **Maps** | Mapbox GL JS / React Map GL | Best-in-class for flight paths, waypoints |
| **State** | Zustand | Lightweight, predictable state management |
| **Hosting** | Render (backend) + Vercel (frontend) | Free tiers available |

---

## Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     FRONTEND (dsms-web)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Mission  â”‚ â”‚  Fleet   â”‚ â”‚ Monitor  â”‚ â”‚     Analytics        â”‚â”‚
â”‚  â”‚ Planner  â”‚ â”‚Dashboard â”‚ â”‚  (Live)  â”‚ â”‚      Portal          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ REST       â”‚ REST       â”‚ WebSocket        â”‚ REST
        â–¼            â–¼            â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        BACKEND (dsms)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                    api/endpoints/                           â”‚â”‚
â”‚  â”‚  mission_index, mission_details, drone_index, analytics...  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                             â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                      services/                              â”‚â”‚
â”‚  â”‚  mission_service, fleet_service, path_generator, ...       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                             â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                       models/                               â”‚â”‚
â”‚  â”‚  Drone, Mission, Waypoint, FlightPath, TelemetryPoint       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  consumers/   â”‚  â”‚    tasks/     â”‚  â”‚     simulator/       â”‚â”‚
â”‚  â”‚  (WebSocket)  â”‚  â”‚   (Celery)    â”‚  â”‚   (Flight Engine)    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MongoDB    â”‚       â”‚    Redis     â”‚      â”‚    Celery    â”‚
â”‚   (Atlas)    â”‚       â”‚  (Upstash)   â”‚      â”‚   Workers    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Monorepo Structure (Sentry-Inspired)

```
FlytBase-DSMS/
â”‚
â”œâ”€â”€ src/
â”‚   â”‚
â”‚   â”œâ”€â”€ dsms/                            # ğŸ Django Backend
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ dsms/                        # Django project root
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ conf/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ base.py          # Shared settings
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ development.py   # Dev overrides
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ production.py    # Prod overrides
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ urls.py              # Root URL config
â”‚   â”‚   â”‚   â”œâ”€â”€ asgi.py                  # ASGI for Channels
â”‚   â”‚   â”‚   â””â”€â”€ wsgi.py                  # WSGI for production
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ models/                      # ğŸ“¦ ALL Data Models
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py              # Re-exports all models
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py                  # BaseDocument class
â”‚   â”‚   â”‚   â”œâ”€â”€ drone.py                 # Drone
â”‚   â”‚   â”‚   â”œâ”€â”€ mission.py               # Mission, Waypoint, FlightPath
â”‚   â”‚   â”‚   â”œâ”€â”€ telemetry.py             # TelemetryPoint (time-series)
â”‚   â”‚   â”‚   â””â”€â”€ organization.py          # Site, Organization (future)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ api/                         # ğŸŒ REST API Layer
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ bases.py                 # BaseEndpoint, error handling
â”‚   â”‚   â”‚   â”œâ”€â”€ urls.py                  # API URL routing
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ endpoints/               # One class per resource
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ mission_index.py     # GET/POST /api/missions/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ mission_details.py   # GET/PATCH/DELETE /api/missions/<id>/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ mission_control.py   # POST /api/missions/<id>/{start,pause,resume,abort}/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ mission_path.py      # POST /api/missions/<id>/generate-path/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ drone_index.py       # GET/POST /api/fleet/drones/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ drone_details.py     # GET/PATCH /api/fleet/drones/<id>/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ fleet_stats.py       # GET /api/fleet/stats/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ analytics.py         # GET /api/analytics/
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ serializers/             # Request/Response schemas
â”‚   â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚       â”œâ”€â”€ mission.py
â”‚   â”‚   â”‚       â”œâ”€â”€ drone.py
â”‚   â”‚   â”‚       â”œâ”€â”€ telemetry.py
â”‚   â”‚   â”‚       â””â”€â”€ analytics.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ services/                    # ğŸ§  Business Logic Layer
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ mission_service.py       # Mission CRUD, lifecycle
â”‚   â”‚   â”‚   â”œâ”€â”€ fleet_service.py         # Drone management
â”‚   â”‚   â”‚   â”œâ”€â”€ path_generator.py        # Flight path algorithms
â”‚   â”‚   â”‚   â”œâ”€â”€ telemetry_service.py     # Telemetry ingestion
â”‚   â”‚   â”‚   â””â”€â”€ analytics_service.py     # Statistics computation
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ tasks/                       # â° Celery Background Tasks
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ celery.py                # Celery app configuration
â”‚   â”‚   â”‚   â”œâ”€â”€ simulator.py             # run_simulation task
â”‚   â”‚   â”‚   â”œâ”€â”€ analytics.py             # generate_report task
â”‚   â”‚   â”‚   â””â”€â”€ cleanup.py               # cleanup_old_telemetry task
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ consumers/                   # ğŸ”Œ WebSocket Handlers
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py                  # BaseConsumer class
â”‚   â”‚   â”‚   â”œâ”€â”€ telemetry.py             # TelemetryConsumer
â”‚   â”‚   â”‚   â””â”€â”€ routing.py               # WebSocket URL routing
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ simulator/                   # ğŸ¤– Drone Simulation Engine
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ engine.py                # DroneSimulator class
â”‚   â”‚   â”‚   â”œâ”€â”€ patterns.py              # FlightPatternGenerator
â”‚   â”‚   â”‚   â”‚                            # (crosshatch, perimeter, spiral)
â”‚   â”‚   â”‚   â””â”€â”€ physics.py               # Movement, battery drain
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ utils/                       # ğŸ”§ Shared Utilities
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ geo.py                   # GeoJSON helpers, distance calc
â”‚   â”‚   â”‚   â”œâ”€â”€ exceptions.py            # Custom exception classes
â”‚   â”‚   â”‚   â””â”€â”€ validators.py            # Validation utilities
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ manage.py
â”‚   â”‚   â””â”€â”€ requirements.txt
â”‚   â”‚
â”‚   â””â”€â”€ dsms-web/                        # âš›ï¸ React Frontend
â”‚       â”œâ”€â”€ public/
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ api/                     # API client (axios/fetch)
â”‚       â”‚   â”‚   â”œâ”€â”€ client.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ missions.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ fleet.ts
â”‚       â”‚   â”‚   â””â”€â”€ analytics.ts
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ components/
â”‚       â”‚   â”‚   â”œâ”€â”€ common/              # Shared UI components
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ Card.tsx
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ Modal.tsx
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ Map.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ missions/            # Mission-specific components
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ MissionCard.tsx
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ MissionForm.tsx
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ WaypointEditor.tsx
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ PathPreview.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ fleet/
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ DroneCard.tsx
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ DroneList.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ monitoring/
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ LiveMap.tsx
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ TelemetryPanel.tsx
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ MissionControls.tsx
â”‚       â”‚   â”‚   â””â”€â”€ analytics/
â”‚       â”‚   â”‚       â”œâ”€â”€ StatsCard.tsx
â”‚       â”‚   â”‚       â””â”€â”€ SurveyTable.tsx
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ pages/
â”‚       â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ MissionPlanner.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ MissionMonitor.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ FleetDashboard.tsx
â”‚       â”‚   â”‚   â””â”€â”€ Analytics.tsx
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ stores/                  # Zustand state stores
â”‚       â”‚   â”‚   â”œâ”€â”€ missionStore.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ fleetStore.ts
â”‚       â”‚   â”‚   â””â”€â”€ telemetryStore.ts
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ hooks/
â”‚       â”‚   â”‚   â”œâ”€â”€ useMissions.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ useWebSocket.ts
â”‚       â”‚   â”‚   â””â”€â”€ useMap.ts
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ types/
â”‚       â”‚   â”‚   â”œâ”€â”€ mission.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ drone.ts
â”‚       â”‚   â”‚   â””â”€â”€ telemetry.ts
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ styles/
â”‚       â”‚   â”‚   â”œâ”€â”€ index.css
â”‚       â”‚   â”‚   â””â”€â”€ variables.css
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ App.tsx
â”‚       â”‚   â”œâ”€â”€ main.tsx
â”‚       â”‚   â””â”€â”€ router.tsx
â”‚       â”‚
â”‚       â”œâ”€â”€ index.html
â”‚       â”œâ”€â”€ package.json
â”‚       â”œâ”€â”€ tsconfig.json
â”‚       â””â”€â”€ vite.config.ts
â”‚
â”œâ”€â”€ config/                              # ğŸ³ Infrastructure Config
â”‚   â”œâ”€â”€ docker/
â”‚   â”‚   â”œâ”€â”€ Dockerfile.backend
â”‚   â”‚   â”œâ”€â”€ Dockerfile.frontend
â”‚   â”‚   â””â”€â”€ Dockerfile.worker
â”‚   â””â”€â”€ nginx/
â”‚       â””â”€â”€ nginx.conf
â”‚
â”œâ”€â”€ scripts/                             # ğŸ“œ Development Scripts
â”‚   â”œâ”€â”€ setup.sh                         # Initial setup
â”‚   â”œâ”€â”€ seed_data.py                     # Seed sample drones/missions
â”‚   â””â”€â”€ generate_types.py                # Generate TS types from serializers
â”‚
â”œâ”€â”€ docs/                                # ğŸ“š Documentation
â”‚   â”œâ”€â”€ ARCHITECTURE.md
â”‚   â”œâ”€â”€ API.md
â”‚   â””â”€â”€ DEPLOYMENT.md
â”‚
â”œâ”€â”€ .env.example                         # Environment template
â”œâ”€â”€ .gitignore
â”œâ”€â”€ docker-compose.yml                   # Production compose
â”œâ”€â”€ docker-compose.dev.yml               # Development compose
â”œâ”€â”€ Makefile                             # Dev commands
â”œâ”€â”€ pyproject.toml                       # Python project config
â””â”€â”€ README.md
```

---

## Data Models

### [drone.py](file:///c:/Users/prate/OneDrive/Desktop/FlytBase-DSMS/src/dsms/models/drone.py)

```python
from mongoengine import Document, StringField, IntField, FloatField
from mongoengine import PointField, DateTimeField, ListField
from datetime import datetime

class Drone(Document):
    """Fleet drone entity"""
    
    # Identity
    drone_id = StringField(required=True, unique=True, max_length=20)
    name = StringField(required=True, max_length=100)
    model = StringField(max_length=50)  # e.g., "DJI Mavic 3"
    
    # Status
    status = StringField(
        choices=['available', 'in_mission', 'charging', 'maintenance', 'offline'],
        default='available'
    )
    battery_level = IntField(min_value=0, max_value=100, default=100)
    
    # Location
    last_location = PointField()  # GeoJSON Point
    last_seen = DateTimeField(default=datetime.utcnow)
    
    # Capabilities
    max_flight_time = IntField(default=30)  # minutes
    max_speed = FloatField(default=15.0)  # m/s
    max_altitude = FloatField(default=120.0)  # meters
    sensors = ListField(StringField())  # ['rgb_camera', 'thermal', 'lidar']
    
    # Organization
    site = StringField(max_length=100)  # e.g., "San Francisco HQ"
    
    meta = {
        'collection': 'drones',
        'indexes': ['drone_id', 'status', 'site']
    }
    
    def __str__(self):
        return f"{self.drone_id} - {self.name}"
```

---

### [mission.py](file:///c:/Users/prate/OneDrive/Desktop/FlytBase-DSMS/src/dsms/models/mission.py)

```python
from mongoengine import (
    Document, EmbeddedDocument, StringField, IntField, FloatField,
    DateTimeField, ReferenceField, EmbeddedDocumentField,
    EmbeddedDocumentListField, PointField, PolygonField, DictField
)
from datetime import datetime


class Waypoint(EmbeddedDocument):
    """Single waypoint in a flight path"""
    order = IntField(required=True)
    location = PointField(required=True)  # [lng, lat]
    altitude = FloatField(required=True)  # meters AGL
    speed = FloatField()  # m/s, None = use default
    heading = FloatField()  # degrees, None = auto
    
    # Actions at waypoint
    action = StringField(choices=['fly_through', 'hover', 'capture', 'rotate'])
    action_params = DictField()  # e.g., {"hover_time": 5, "capture_type": "photo"}


class FlightPath(EmbeddedDocument):
    """Complete flight path configuration"""
    pattern = StringField(
        choices=['waypoint', 'crosshatch', 'perimeter', 'spiral'],
        default='waypoint'
    )
    waypoints = EmbeddedDocumentListField(Waypoint)
    
    # Computed metrics
    total_distance = FloatField()  # meters
    estimated_duration = IntField()  # seconds


class Mission(Document):
    """Survey mission entity"""
    
    # Identity
    mission_id = StringField(required=True, unique=True, max_length=20)
    name = StringField(required=True, max_length=200)
    description = StringField(max_length=1000)
    
    # Assignment
    drone = ReferenceField('Drone')
    site = StringField(max_length=100)
    
    # Survey area
    survey_area = PolygonField()  # GeoJSON Polygon defining the area
    
    # Flight configuration
    flight_path = EmbeddedDocumentField(FlightPath)
    altitude = FloatField(default=50.0)  # meters
    speed = FloatField(default=5.0)  # m/s
    
    # Pattern settings (for auto-generation)
    pattern_type = StringField(
        choices=['waypoint', 'crosshatch', 'perimeter', 'spiral'],
        default='waypoint'
    )
    overlap_percentage = IntField(default=70, min_value=0, max_value=90)
    
    # Data collection
    sensors = ListField(StringField())
    capture_interval = IntField(default=2)  # seconds between captures
    
    # Schedule
    scheduled_start = DateTimeField()
    
    # Execution
    status = StringField(
        choices=['draft', 'scheduled', 'in_progress', 'paused', 'completed', 'aborted', 'failed'],
        default='draft'
    )
    progress = FloatField(default=0.0, min_value=0.0, max_value=100.0)
    current_waypoint_index = IntField(default=0)
    
    # Timestamps
    created_at = DateTimeField(default=datetime.utcnow)
    updated_at = DateTimeField(default=datetime.utcnow)
    started_at = DateTimeField()
    completed_at = DateTimeField()
    
    meta = {
        'collection': 'missions',
        'indexes': ['mission_id', 'status', 'drone', 'site', 'scheduled_start'],
        'ordering': ['-created_at']
    }
    
    def __str__(self):
        return f"{self.mission_id} - {self.name}"
```

---

### [telemetry.py](file:///c:/Users/prate/OneDrive/Desktop/FlytBase-DSMS/src/dsms/models/telemetry.py)

```python
from mongoengine import Document, StringField, IntField, FloatField
from mongoengine import DateTimeField, ReferenceField, PointField
from datetime import datetime


class TelemetryPoint(Document):
    """Real-time telemetry data point (time-series)"""
    
    # References
    mission_id = StringField(required=True)
    drone_id = StringField(required=True)
    
    # Timestamp
    timestamp = DateTimeField(required=True, default=datetime.utcnow)
    
    # Position
    location = PointField(required=True)  # [lng, lat]
    altitude = FloatField()  # meters
    heading = FloatField()  # degrees (0-360)
    speed = FloatField()  # m/s
    
    # Status
    battery_level = IntField(min_value=0, max_value=100)
    signal_strength = IntField(min_value=0, max_value=100)
    
    # Mission progress
    current_waypoint_index = IntField()
    distance_traveled = FloatField()  # meters
    distance_remaining = FloatField()  # meters
    
    meta = {
        'collection': 'telemetry',
        'indexes': [
            ('mission_id', '-timestamp'),
            ('drone_id', '-timestamp'),
            {'fields': ['timestamp'], 'expireAfterSeconds': 604800}  # 7 days TTL
        ],
        # MongoDB Time-Series collection settings
        'timeseries': {
            'timeField': 'timestamp',
            'metaField': 'mission_id',
            'granularity': 'seconds'
        }
    }
```

---

## API Layer Pattern

### Base Endpoint ([api/bases.py](file:///c:/Users/prate/OneDrive/Desktop/FlytBase-DSMS/src/dsms/api/bases.py))

```python
from rest_framework.views import APIView
from rest_framework.response import Response
from rest_framework import status
from dsms.utils.exceptions import DSMSError, NotFoundError, ValidationError


class BaseEndpoint(APIView):
    """
    Base class for all API endpoints.
    Provides consistent error handling and response formatting.
    """
    
    def handle_exception(self, exc):
        """Centralized exception handling"""
        if isinstance(exc, NotFoundError):
            return Response(
                {'error': str(exc), 'code': 'not_found'},
                status=status.HTTP_404_NOT_FOUND
            )
        if isinstance(exc, ValidationError):
            return Response(
                {'error': str(exc), 'code': 'validation_error'},
                status=status.HTTP_400_BAD_REQUEST
            )
        if isinstance(exc, DSMSError):
            return Response(
                {'error': str(exc), 'code': exc.code},
                status=status.HTTP_400_BAD_REQUEST
            )
        return super().handle_exception(exc)
    
    def respond(self, data=None, status_code=200):
        """Standardized response helper"""
        return Response(data, status=status_code)
    
    def respond_created(self, data):
        return self.respond(data, status_code=status.HTTP_201_CREATED)
    
    def respond_no_content(self):
        return Response(status=status.HTTP_204_NO_CONTENT)
```

---

### Example Endpoint ([api/endpoints/mission_details.py](file:///c:/Users/prate/OneDrive/Desktop/FlytBase-DSMS/src/dsms/api/endpoints/mission_details.py))

```python
from dsms.api.bases import BaseEndpoint
from dsms.api.serializers import MissionSerializer, MissionUpdateSerializer
from dsms.services import mission_service


class MissionDetailsEndpoint(BaseEndpoint):
    """
    GET    /api/missions/<mission_id>/  - Get mission details
    PATCH  /api/missions/<mission_id>/  - Update mission
    DELETE /api/missions/<mission_id>/  - Delete mission
    """
    
    def get(self, request, mission_id):
        mission = mission_service.get_mission(mission_id)
        serializer = MissionSerializer(mission)
        return self.respond(serializer.data)
    
    def patch(self, request, mission_id):
        serializer = MissionUpdateSerializer(data=request.data)
        serializer.is_valid(raise_exception=True)
        
        mission = mission_service.update_mission(mission_id, serializer.validated_data)
        return self.respond(MissionSerializer(mission).data)
    
    def delete(self, request, mission_id):
        mission_service.delete_mission(mission_id)
        return self.respond_no_content()
```

---

## Service Layer Pattern

### Mission Service ([services/mission_service.py](file:///c:/Users/prate/OneDrive/Desktop/FlytBase-DSMS/src/dsms/services/mission_service.py))

```python
from datetime import datetime
from dsms.models import Mission, Drone
from dsms.utils.exceptions import NotFoundError, ValidationError, MissionError
from dsms.services import path_generator


def get_mission(mission_id: str) -> Mission:
    """Get a mission by ID"""
    try:
        return Mission.objects.get(mission_id=mission_id)
    except Mission.DoesNotExist:
        raise NotFoundError(f"Mission {mission_id} not found")


def list_missions(filters: dict = None) -> list[Mission]:
    """List missions with optional filters"""
    queryset = Mission.objects
    
    if filters:
        if 'status' in filters:
            queryset = queryset.filter(status=filters['status'])
        if 'site' in filters:
            queryset = queryset.filter(site=filters['site'])
        if 'drone_id' in filters:
            drone = Drone.objects.get(drone_id=filters['drone_id'])
            queryset = queryset.filter(drone=drone)
    
    return list(queryset)


def create_mission(data: dict) -> Mission:
    """Create a new mission"""
    # Generate mission ID
    count = Mission.objects.count()
    mission_id = f"MSN-{count + 1:04d}"
    
    mission = Mission(
        mission_id=mission_id,
        name=data['name'],
        description=data.get('description', ''),
        site=data.get('site'),
        survey_area=data.get('survey_area'),
        altitude=data.get('altitude', 50.0),
        speed=data.get('speed', 5.0),
        pattern_type=data.get('pattern_type', 'waypoint'),
        overlap_percentage=data.get('overlap_percentage', 70),
        sensors=data.get('sensors', []),
        capture_interval=data.get('capture_interval', 2),
    )
    
    # Assign drone if provided
    if 'drone_id' in data:
        drone = Drone.objects.get(drone_id=data['drone_id'])
        mission.drone = drone
    
    mission.save()
    return mission


def update_mission(mission_id: str, data: dict) -> Mission:
    """Update an existing mission"""
    mission = get_mission(mission_id)
    
    if mission.status == 'in_progress':
        raise MissionError("Cannot update mission while in progress")
    
    for key, value in data.items():
        if hasattr(mission, key):
            setattr(mission, key, value)
    
    mission.updated_at = datetime.utcnow()
    mission.save()
    return mission


def delete_mission(mission_id: str) -> None:
    """Delete a mission"""
    mission = get_mission(mission_id)
    
    if mission.status == 'in_progress':
        raise MissionError("Cannot delete mission while in progress")
    
    mission.delete()


def start_mission(mission_id: str) -> Mission:
    """Start a mission execution"""
    mission = get_mission(mission_id)
    
    if mission.status not in ['draft', 'scheduled']:
        raise MissionError(f"Cannot start mission with status '{mission.status}'")
    
    if not mission.drone:
        raise ValidationError("Mission has no drone assigned")
    
    if not mission.flight_path or not mission.flight_path.waypoints:
        raise ValidationError("Mission has no flight path defined")
    
    # Update drone status
    mission.drone.status = 'in_mission'
    mission.drone.save()
    
    # Update mission status
    mission.status = 'in_progress'
    mission.started_at = datetime.utcnow()
    mission.progress = 0.0
    mission.save()
    
    # Start simulation task
    from dsms.tasks.simulator import run_mission_simulation
    run_mission_simulation.delay(mission_id)
    
    return mission


def pause_mission(mission_id: str) -> Mission:
    """Pause a running mission"""
    mission = get_mission(mission_id)
    
    if mission.status != 'in_progress':
        raise MissionError("Mission is not in progress")
    
    mission.status = 'paused'
    mission.save()
    return mission


def resume_mission(mission_id: str) -> Mission:
    """Resume a paused mission"""
    mission = get_mission(mission_id)
    
    if mission.status != 'paused':
        raise MissionError("Mission is not paused")
    
    mission.status = 'in_progress'
    mission.save()
    
    # Resume simulation
    from dsms.tasks.simulator import run_mission_simulation
    run_mission_simulation.delay(mission_id)
    
    return mission


def abort_mission(mission_id: str) -> Mission:
    """Abort a mission"""
    mission = get_mission(mission_id)
    
    if mission.status not in ['in_progress', 'paused']:
        raise MissionError("Mission cannot be aborted")
    
    mission.status = 'aborted'
    mission.completed_at = datetime.utcnow()
    mission.save()
    
    # Release drone
    if mission.drone:
        mission.drone.status = 'available'
        mission.drone.save()
    
    return mission


def generate_flight_path(mission_id: str) -> Mission:
    """Auto-generate flight path based on survey area and pattern"""
    mission = get_mission(mission_id)
    
    if not mission.survey_area:
        raise ValidationError("Mission has no survey area defined")
    
    flight_path = path_generator.generate_path(
        survey_area=mission.survey_area,
        pattern=mission.pattern_type,
        altitude=mission.altitude,
        overlap=mission.overlap_percentage,
        speed=mission.speed
    )
    
    mission.flight_path = flight_path
    mission.save()
    return mission
```

---

## Real-time WebSocket

### Telemetry Consumer ([consumers/telemetry.py](file:///c:/Users/prate/OneDrive/Desktop/FlytBase-DSMS/src/dsms/consumers/telemetry.py))

```python
import json
from channels.generic.websocket import AsyncWebsocketConsumer


class TelemetryConsumer(AsyncWebsocketConsumer):
    """
    WebSocket consumer for real-time mission telemetry.
    
    Connect: ws://host/ws/missions/<mission_id>/telemetry/
    """
    
    async def connect(self):
        self.mission_id = self.scope['url_route']['kwargs']['mission_id']
        self.room_group_name = f'mission_{self.mission_id}'
        
        # Join mission room
        await self.channel_layer.group_add(
            self.room_group_name,
            self.channel_name
        )
        await self.accept()
    
    async def disconnect(self, close_code):
        # Leave mission room
        await self.channel_layer.group_discard(
            self.room_group_name,
            self.channel_name
        )
    
    async def telemetry_update(self, event):
        """Send telemetry update to WebSocket client"""
        await self.send(text_data=json.dumps({
            'type': 'telemetry',
            'data': event['data']
        }))
    
    async def status_change(self, event):
        """Send status change to WebSocket client"""
        await self.send(text_data=json.dumps({
            'type': 'status_change',
            'data': event['data']
        }))
```

---

## Drone Simulator

### Simulation Engine ([simulator/engine.py](file:///c:/Users/prate/OneDrive/Desktop/FlytBase-DSMS/src/dsms/simulator/engine.py))

```python
import math
from datetime import datetime
from typing import Tuple
from dsms.models import Mission, TelemetryPoint
from dsms.simulator.physics import calculate_movement, drain_battery


class DroneSimulator:
    """
    Simulates drone flying a mission path.
    Generates realistic telemetry at configurable intervals.
    """
    
    TELEMETRY_INTERVAL = 1.0  # seconds
    
    def __init__(self, mission: Mission):
        self.mission = mission
        self.waypoints = list(mission.flight_path.waypoints)
        self.current_waypoint_idx = mission.current_waypoint_index or 0
        
        # Current state
        if self.waypoints:
            first_wp = self.waypoints[0]
            self.position = first_wp.location['coordinates']
            self.altitude = first_wp.altitude
        else:
            self.position = [0, 0]
            self.altitude = 0
            
        self.heading = 0.0
        self.speed = mission.speed or 5.0
        self.battery = mission.drone.battery_level or 100
        self.distance_traveled = 0.0
    
    def tick(self, delta: float = 1.0) -> dict:
        """
        Advance simulation by delta seconds.
        Returns telemetry data for this tick.
        """
        if self.current_waypoint_idx >= len(self.waypoints):
            return {'complete': True}
        
        target_wp = self.waypoints[self.current_waypoint_idx]
        target_pos = target_wp.location['coordinates']
        
        # Calculate movement
        new_pos, distance_moved, reached = calculate_movement(
            current=self.position,
            target=target_pos,
            speed=self.speed,
            delta=delta
        )
        
        self.position = new_pos
        self.distance_traveled += distance_moved
        
        # Calculate heading
        self.heading = self._calculate_heading(self.position, target_pos)
        
        # Drain battery
        self.battery = drain_battery(self.battery, delta)
        
        # Check if reached waypoint
        if reached:
            self.current_waypoint_idx += 1
        
        # Calculate progress
        total_waypoints = len(self.waypoints)
        progress = (self.current_waypoint_idx / total_waypoints) * 100
        
        return {
            'complete': self.current_waypoint_idx >= len(self.waypoints),
            'position': self.position,
            'altitude': self.altitude,
            'heading': self.heading,
            'speed': self.speed,
            'battery': self.battery,
            'current_waypoint': self.current_waypoint_idx,
            'progress': min(progress, 100.0),
            'distance_traveled': self.distance_traveled
        }
    
    def _calculate_heading(self, current: list, target: list) -> float:
        """Calculate heading in degrees from current to target"""
        dx = target[0] - current[0]
        dy = target[1] - current[1]
        heading = math.degrees(math.atan2(dx, dy))
        return (heading + 360) % 360
```

---

## Makefile Commands

```makefile
.PHONY: help setup dev test lint format migrate seed simulate docker-up docker-down

help:
	@echo "DSMS Development Commands"
	@echo "========================="
	@echo "make setup      - Install dependencies and setup environment"
	@echo "make dev        - Run development servers (backend + frontend)"
	@echo "make dev-back   - Run backend only"
	@echo "make dev-front  - Run frontend only"
	@echo "make test       - Run all tests"
	@echo "make lint       - Run linters"
	@echo "make format     - Format code"
	@echo "make seed       - Seed database with sample data"
	@echo "make simulate   - Run drone simulator manually"
	@echo "make docker-up  - Start all services in Docker"
	@echo "make docker-down - Stop all Docker services"

setup:
	cd src/dsms && python -m venv venv && venv/Scripts/activate && pip install -r requirements.txt
	cd src/dsms-web && npm install
	cp .env.example .env
	@echo "Setup complete! Edit .env with your configuration."

dev:
	make dev-back &
	make dev-front

dev-back:
	cd src/dsms && python manage.py runserver

dev-front:
	cd src/dsms-web && npm run dev

test:
	cd src/dsms && python manage.py test
	cd src/dsms-web && npm test

seed:
	cd src/dsms && python manage.py shell < scripts/seed_data.py

docker-up:
	docker-compose -f docker-compose.dev.yml up -d

docker-down:
	docker-compose -f docker-compose.dev.yml down
```

---

## API Endpoints Summary

### Missions
| Method | Endpoint | Description |
|--------|----------|-------------|
| `GET` | `/api/missions/` | List all missions |
| `POST` | `/api/missions/` | Create mission |
| `GET` | `/api/missions/<id>/` | Get mission details |
| `PATCH` | `/api/missions/<id>/` | Update mission |
| `DELETE` | `/api/missions/<id>/` | Delete mission |
| `POST` | `/api/missions/<id>/start/` | Start mission |
| `POST` | `/api/missions/<id>/pause/` | Pause mission |
| `POST` | `/api/missions/<id>/resume/` | Resume mission |
| `POST` | `/api/missions/<id>/abort/` | Abort mission |
| `POST` | `/api/missions/<id>/generate-path/` | Generate flight path |

### Fleet
| Method | Endpoint | Description |
|--------|----------|-------------|
| `GET` | `/api/fleet/drones/` | List all drones |
| `POST` | `/api/fleet/drones/` | Register drone |
| `GET` | `/api/fleet/drones/<id>/` | Get drone details |
| `PATCH` | `/api/fleet/drones/<id>/` | Update drone |
| `GET` | `/api/fleet/stats/` | Get fleet statistics |

### Analytics
| Method | Endpoint | Description |
|--------|----------|-------------|
| `GET` | `/api/analytics/summary/` | Organization-wide stats |
| `GET` | `/api/analytics/missions/` | Mission statistics |

### WebSocket
| Endpoint | Description |
|----------|-------------|
| `ws://host/ws/missions/<id>/telemetry/` | Real-time mission telemetry |

---

## Development Phases

### Phase 1: Project Setup (2-3 hours)
- [x] Approve implementation plan
- [ ] Initialize monorepo structure
- [ ] Setup Django with MongoEngine
- [ ] Setup React with Vite + TypeScript
- [ ] Configure MongoDB Atlas connection
- [ ] Create Makefile

### Phase 2: Mission Planning (8-10 hours)
- [ ] Implement models (Drone, Mission, Waypoint)
- [ ] Implement mission service layer
- [ ] Implement mission API endpoints
- [ ] Implement path generation algorithms
- [ ] Build Mission Planner UI with map

### Phase 3: Real-time Monitoring (6-8 hours)
- [ ] Setup Django Channels
- [ ] Implement telemetry consumer
- [ ] Build drone simulator engine
- [ ] Implement Celery simulation task
- [ ] Build live monitoring UI

### Phase 4: Fleet & Analytics (5-6 hours)
- [ ] Implement fleet service and API
- [ ] Implement analytics service
- [ ] Build Fleet Dashboard UI
- [ ] Build Analytics Portal UI

### Phase 5: Polish & Deploy (4-5 hours)
- [ ] Production configuration
- [ ] Deploy to Render + Vercel
- [ ] Write documentation
- [ ] Record demo video

---

## Verification Plan

### Automated Tests
- Unit tests for services (mission_service, path_generator)
- API endpoint tests
- WebSocket consumer tests
- Simulator engine tests

### Manual Verification
1. Create a new mission with polygon area
2. Generate crosshatch flight path
3. Assign drone and start mission
4. Watch real-time tracking on map
5. Pause/resume/abort mission
6. View completed mission in analytics

---

## Next Steps

1. âœ… Review and approve this updated plan
2. Initialize the monorepo structure
3. Setup Django project with MongoEngine
4. Begin Phase 2: Mission Planning
